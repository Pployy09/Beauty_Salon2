<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    
    <!-- CSS -->
    <link rel="stylesheet" href="./css/style.css">
    
    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@700&family=Noto+Sans+Thai:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Pacifico&family=Raleway:wght@200&display=swap" rel="stylesheet">
      
    <!--
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    -->
    
</head>
<body>
  <!-- Header -->
    <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-4 ">
        <div class="col-md-3 mb-2 mb-md-0 ">
          <div class="fontlogo logomore"><%=home.inputLogo%></div>
        </div>
    
        <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0 ">
          <li><a href="./home-user" class="nav-link px-3 heaDer fontAll ">หน้าแรก</a></li>
          <li><a href="./booking-user" class="active nav-link px-3 heaDer fontAll">การจองคิว</a></li>
          <li><a href="./service-user" class="nav-link px-3 heaDer fontAll">บริการของร้าน</a></li>
          <li><a href="./contact-user" class="nav-link px-3 heaDer fontAll">ติดต่อ</a></li>
          
        </ul>
    
        <% if (loggedIn) { %>
          <div class=" nav me-3 text-end">
            <div><a href="./information-user" class=" nav-link px-3 heaDer fontAll">Hi, <%=UserData.username%></a></div>
            <div><a href="./logout" class="btn btn-danger">ออกจากระบบ</a></div>
          </div>
          <% } %>
      
          <% if (!loggedIn) { %>
            <div class=" nav me-3 text-end">
              <div><a href="./login-user" class="nav-link fontAll heaDer login">เข้าสู่ระบบ</a></div>
              <div><a href="./register" class="nav-link fontAll heaDer login">สมัครสมาชิก</a></div>
            </div>
            <% } %>

        </header>

    <!--การจองคิว-->    
    <section  id="booking">
      
        <div class="container">
              <h3 class="Bookingg fontAll">จองคิว</h3>
              <div class=" table-booking"></div>
        
              
            <form action="/booking-user" method="POST" >
              
              <div class="mt-5 date-booking ">
                <label for="dateBooking" 
                class="form-label fontAll textBooking">เลือกวันที่</label>
                <input id="dateBooking"
                type="date" min="0000-00-00" max="0000-00-00"
                placeholder="วว/ดด/ปปปป" 
                class="form-control" 
                name="booking_date_user" 
                required >
              </div>

           
              <div class="mt-3 choose-service">
                <label for="chooseServiceUser" 
                class="form-label fontAll textBooking">เลือกบริการ</label>

                <select name="booking_service_user" id="customSelect" class="custom-select-service" required>
                   <% var serT = [] ; %>
                  <% ServiceDataList.forEach(serviceData =>{ %> 
                    <option  value= " <%= serviceData.service_name  %> " class="fontAll" > 
                      <% const se = serviceData.service_time %> <%= serviceData.service_name %> ( <%= serviceData.service_price  %> บาท )  
                    </option>
                    <% serT.push(se); %>
                    
                    <% }); %> 
                </select>
               
                 
                   <!--   <div class="select">
                    <% ServiceDataList.forEach(serviceData =>{ %> 
                      <div class="item"><%= serviceData.service_name %> ( <%= serviceData.service_price  %> บาท )</div>
                    <% }) %> 
                   </div>
                  -->
              </div>
                <% var numBooking = [];  %>
                <% QueueBookingCustomerData.forEach(booking =>{%>
                  <% const bookingTimeInt = parseInt(booking.booking_time_user) %>
                   <% numBooking.push(bookingTimeInt); %> 
                  <% })  %>
                  <%  console.log(numBooking) %>

          
              <div class="mt-3 choose-time">
                <label for="timeBooking" 
                class="form-label fontAll textBooking">เลือกเวลา</label>

                
                    
                   
                     
                  <% var bookingTArray=[] %>
               
                     <select name="booking_time_user[]"  class="select-time"  id="select-time"  multiple="multiple" required > 
                            
                           <%  HomeData.forEach(homeData => { %>
                           
                            <%  let timeOpen = parseInt(homeData.time_open); %>
                            <%  let timeForService1  = timeOpen+1;  %>
                            <%  let timeClose = parseInt(homeData.time_close); %>

                            <% let timeOpen1 = timeOpen; %>
                            <% let timeForService2  = timeForService1; ;%>
                            <% let timeClose1 = timeClose;%>

                            <% for(; timeOpen1 < timeClose1  ; timeOpen1++ ){ %>
                              <% if(timeOpen1 <= 9 ){%>
                                <% var shopTime = "0"+timeOpen1+".00"+"-"+timeForService2+".00" %>
                                <% bookingTArray.push(shopTime); %>
                                <% timeForService2++ %>
    
                              <% }else{ %>
                                <% var shopTime = timeOpen1+".00"+"-"+timeForService2+".00" %>
                                <% bookingTArray.push(shopTime); %>
                                <% timeForService2++ %>
                                <% } %>
                             
                             <% } %>
                           
                            
                                <% for( ; timeOpen < timeClose  ; timeOpen++ ) { %> 
                                    <% if(timeOpen<=9) {%> 
                                      
                                      <option  value= "0<%= timeOpen %>.00 - <%= timeForService1 %>.00"  class="fontAll "> 0<%= timeOpen %>.00 - <%= timeForService1 %>.00 </option>
                                      
                                    <% timeForService1++ %> 
                                    <% }else{ %>   
                                      <option  value= "<%= timeOpen %>.00 - <%= timeForService1 %>.00"  class="fontAll "> <%= timeOpen %>.00 - <%= timeForService1 %>.00 </option> 
                                      <% timeForService1++ %> 
                                    <% } %>
                                
                                <% } %>
                               
                             
                        <% })  %> 
                          
                        
                      <% //console.log(bookingTArray) %>
                        
                    </select> 

                    
                  
                
                  
              </div>

              <div class="bookingNow2">
                <button type="button" class="btn fontAll bookingButton" data-bs-toggle="modal" data-bs-target="#confirmModel">จองคิว</button>
              </div>

              <div class="modal fade" id="confirmModel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
        
                    <div class="modal-body">
                      <h4 class="colorText">ต้องการจองคิวใช่ไหม</h4> 
                     
        
                    </div>
                    
                    <div class="modal-footer">
                     
                        <button type="submit" class="fontAll buttonbt">ยืนยันการจองคิว</button>
                      
                    </div>
        
                  </div>
                </div>
              </div>

            </form>
         
       </div>
       
    </section>
 
  <%- include ('./footer') %>

  <%- include ('./chat') %>

  <!-- JavaScript-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" 
    crossorigin="anonymous">
  </script>

  <script 
  src="/js/dateBooking.js" 
  charset="utf-8">
  </script>
  <script 
  src="/js/booking-user.js" 
  charset="utf-8">
  </script>
  <script  
  src="/js/select-time.js" 
  charset="utf-8">
  </script>

  <script>
    
    var itemS =  [];
    var timeService = '<%= serT %>'.split(',');
    var item = document.getElementsByClassName("item-service");
    for(let i = 0; i < item.length ; i++){
      itemS.push('itemService'+[i]);
      
      var itemServiceNum = itemS[i];
      var itemService = document.getElementById(itemServiceNum);
      
      itemService.onclick = (event) =>{
           alert("เลือกเวลาได้ " + timeService[i] + " ชั่วโมง ")
        
        };
     
     }
     
  </script>

  <script>
    //ในแต่ละ 1 ชั่วโมง จะกดได้กี่ครั้ง
    var numEmp = parseInt('<%= empList.length %>');
    
    //console.log( numEmp);
    var timeOpen = '<%= bookingTArray %>'.split(',');
      var timeOpenInt =[];
      
      // timeOpen--> int
      for(let t = 0 ; t<timeOpen.length ; t++){
        var timeOpenint = parseInt(timeOpen[t]);
        timeOpenInt.push(timeOpenint);
      }
    
      
      console.log(timeOpenInt);

      var itemB =  [];
      var timeBooking = '<%= numBooking %>'.split(',');
      var timeBookingInt =[];
      
      for(let w = 0  ; w < timeBooking.length  ; w++){
        var  timeBookingint =  parseInt(timeBooking[w])
        timeBookingInt.push(timeBookingint);
      }
      //ขนาดอาเรย์เท่ากันหรือไม่
      function arraysHaveEqualValues(array1,array2){
        for(let r = 0;r < Math.min(array1.length, array2.length); r++){
          if (array1[r] !== array2[r]) {
               return false;
          }
        }
        return true;
      }
      //เปรียบเทียบค่าข้างในอาเรย์
      var indexx= [];
      function valuesInArray(array1, array2) {
  
        for (let r = 0; r < array1.length; r++) {
          if (array2.indexOf(array1[r]) === -1) {
            return false;
          }
        
       const cc    = array2.indexOf(array1[r]);
       indexx.push(cc);
       
       

      }
       
       return true;
        }
     
      

      const resultEqualValues  = arraysHaveEqualValues(timeOpenInt,timeBookingInt);
      console.log(resultEqualValues);

      const resultSubset = valuesInArray(timeBookingInt, timeOpenInt);
      console.log(resultSubset);

      const sortedNumbers = indexx.sort((a, b) => a - b);
      
      console.log(sortedNumbers);
      console.log(timeBookingInt);
  </script>
  

</body>
</html>